(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{18:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAACWCAYAAAAouC1GAAABcElEQVR4nO3RQQ0AIBDAsAP/nuGNAvZoFSzZOjNnyNi/A3gZEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsRcy7UDKhga1CUAAAAASUVORK5CYII="},46:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAACWCAYAAAAouC1GAAABcElEQVR4nO3RQQ0AIBDAsAP/nuGNAvZoFSzZmjlnyNi/A3gZEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsQYEmNIjCExhsRcybcDKgRYUCEAAAAASUVORK5CYII="},47:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAADH0lEQVR4nO3UMQEAIAzAsIFY/DsAGRxNFPTqmjN3gKT9OwD4xwAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAgzAAg7AHxPgNloRSyTgAAAABJRU5ErkJggg=="},48:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAACWCAYAAAAouC1GAAABc0lEQVR4nO3RQREAIRDAsOP8S1tP8EYBfSQKOtM1M/sj438dwM2QGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJMaQGENiDIkxJOYAhDIEj9TrJPAAAAAASUVORK5CYII="},49:function(e,t,n){e.exports=n(81)},54:function(e,t,n){},70:function(e,t,n){},81:function(e,t,n){"use strict";n.r(t);var a=n(1),s=n.n(a),r=n(15),i=n.n(r),l=n(4),c=n(9),o=n(6),u=n(5),A=n(7),h=(n(54),n(82)),m=n(83),d=n(84),g=n(85),E=n(58),v=function(e){function t(){return Object(l.a)(this,t),Object(o.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(A.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"text-center"},s.a.createElement("h1",null,s.a.createElement("img",{src:null,title:"Fallen Crusade",alt:"Fallen Crusade"})))}}]),t}(s.a.Component),p=n(14),b=2,f=3,y=4,j=5,z=6,k=8,C=9,I=10,O=11,x=12,N=13,Q=14,w=16,M=17,S=18,L=25,D=26,Y="ok",G="bad",R=new(function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(o.a)(this,Object(u.a)(t).call(this))).socket=null,e.clientID=null,e.accessLevel=0,e}return Object(A.a)(t,e),Object(c.a)(t,[{key:"connect",value:function(){var e=this;if(!this.isConnected){var t=window.location.origin.replace(":3000",":8080").replace("https://","wss://").replace("http://","ws://");this.socket=new WebSocket(t),this.socket.addEventListener("open",function(){e.emit("connect")}),this.socket.addEventListener("error",function(t){e.emit("error",t)}),this.socket.addEventListener("message",function(t){e.handleData(t.data.toString())}),this.socket.addEventListener("close",function(){e.emit("close")})}}},{key:"handleData",value:function(e){var t=this;e.split("?&?").forEach(function(e){var n,a,s;try{var r=JSON.parse(e);n=r.opCode||-1,a=r.data||{},s=r.status||G,n!==N&&console.log(r)}catch(i){return}t.processResponse(n,a,s)})}},{key:"processResponse",value:function(e,t,n){switch(e){case b:this.handleLogin(t,n);break;case f:this.handleLogout(t,n);break;case y:this.handleCharacterList(t,n);break;case j:this.handleCharacterCreate(t,n);break;case k:this.handleMapEnter(t,n);break;case C:this.handleInstanceEnter(t,n);break;case I:this.handleChatMessage(t,n);break;case O:this.handleObjectCreate(t,n);break;case x:this.handleObjectDelete(t,n);break;case N:this.handleObjectUpdate(t,n);break;case Q:this.handleObjectStats(t,n);break;case w:this.handleAbilityList(t,n);break;case L:this.handleCreateInstance(t,n);break;case D:this.handleMapPlayers(t,n)}}},{key:"handleLogin",value:function(e,t){var n=e.message,a=void 0===n?null:n,s=e.clientID,r=void 0===s?null:s,i=e.accessLevel,l=void 0===i?1:i;t===Y&&(this.clientID=r,this.accessLevel=l),this.emit("login",{message:a,status:t})}},{key:"handleLogout",value:function(e,t){var n=e.message,a=void 0===n?null:n;this.emit("logout",{message:a,status:t})}},{key:"handleCharacterList",value:function(e,t){var n=e.message,a=void 0===n?null:n,s=e.characterList,r=void 0===s?null:s;this.emit("character-list",{message:a,characterList:r,status:t})}},{key:"handleCharacterCreate",value:function(e,t){var n=e.message,a=void 0===n?null:n;this.emit("character-create",{message:a,status:t})}},{key:"handleMapEnter",value:function(e,t){var n=e.message,a=void 0===n?null:n,s=e.mapState,r=void 0===s?null:s;this.emit("enter-map",{message:a,mapState:r,status:t})}},{key:"handleInstanceEnter",value:function(e,t){var n=e.message,a=void 0===n?null:n,s=e.mapState,r=void 0===s?null:s;this.emit("enter-instance",{message:a,mapState:r,status:t})}},{key:"handleChatMessage",value:function(e,t){var n=e.chat,a=void 0===n?"":n,s=e.from,r=void 0===s?null:s;this.emit("chat",{chat:a,from:r,status:t})}},{key:"handleObjectCreate",value:function(e){var t=e.spawnState,n=void 0===t?null:t;this.emit("object-create",{spawnState:n})}},{key:"handleObjectDelete",value:function(e){var t=e.objectID,n=void 0===t?null:t;this.emit("object-delete",{objectID:n})}},{key:"handleObjectUpdate",value:function(e){var t=e.updateState,n=void 0===t?null:t;this.emit("object-update",{updateState:n})}},{key:"handleObjectStats",value:function(e,t){var n=e.message,a=void 0===n?null:n,s=e.stats,r=void 0===s?null:s;this.emit("object-stats",{message:a,stats:r,status:t})}},{key:"handleAbilityList",value:function(e,t){var n=e.message,a=void 0===n?null:n,s=e.abilityList,r=void 0===s?null:s;this.emit("ability-list",{message:a,abilityList:r,status:t})}},{key:"handleCreateInstance",value:function(e,t){var n=e.message,a=void 0===n?null:n;this.emit("create-instance",{message:a,status:t})}},{key:"handleMapPlayers",value:function(e,t){e.message;var n=e.players,a=void 0===n?null:n;this.emit("map-players",{players:a,status:t})}},{key:"login",value:function(e,t){this.send(b,{username:e,password:t,version:"0.1.0"})}},{key:"logout",value:function(){this.clientID=null,this.send(f)}},{key:"getCharacterList",value:function(){this.send(y)}},{key:"createCharacter",value:function(e,t){this.send(j,{name:e,skin:t})}},{key:"selectCharacter",value:function(e){this.send(z,{name:e})}},{key:"chatMessage",value:function(e){this.send(I,{chat:e})}},{key:"playerUpdate",value:function(e){this.send(N,e)}},{key:"getObjectStats",value:function(e){this.send(Q,{objectID:e})}},{key:"getAbilityList",value:function(){this.send(w)}},{key:"upgradeAbility",value:function(e){this.send(M,{abilityName:e})}},{key:"castAbility",value:function(e,t){this.send(S,{abilityName:e,objectID:t})}},{key:"createInstance",value:function(e){this.send(L,{instanceName:e})}},{key:"getMapPlayers",value:function(){this.send(D)}},{key:"send",value:function(e,t){this.sendString(JSON.stringify({opCode:e,data:t}))}},{key:"sendString",value:function(e){this.isConnected&&this.socket.send(e+"?&?")}},{key:"isConnected",get:function(){return this.socket&&1===this.socket.readyState}}]),t}(p.EventEmitter)),U=function(e){function t(){return Object(l.a)(this,t),Object(o.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(A.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement("footer",{className:"text-center"},s.a.createElement("hr",null),"David Rosenblum, 2019 | v","0.1.0")}}]),t}(s.a.Component),J=new(function(e){function t(){return Object(l.a)(this,t),Object(o.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(A.a)(t,e),Object(c.a)(t,[{key:"modal",value:function(e,t,n){this.emit("modal",{header:e,body:t,footer:n})}}]),t}(p.EventEmitter)),P=new(function(e){function t(){return Object(l.a)(this,t),Object(o.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(A.a)(t,e),Object(c.a)(t,[{key:"showMenu",value:function(e){this.emit("menu",{menu:e})}},{key:"showLogin",value:function(){this.showMenu("login")}},{key:"showRegister",value:function(){this.showMenu("register")}},{key:"showCharacterSelect",value:function(){this.showMenu("character-select")}},{key:"showCharacterCreate",value:function(){this.showMenu("character-create")}},{key:"showGame",value:function(){this.showMenu("game")}}]),t}(p.EventEmitter)),T=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(o.a)(this,Object(u.a)(t).call(this,e))).usernameInput=null,n.passwordInput=null,n.usernameToSave=null,n.state={pending:!1},n.onConnect=function(){n.setState({pending:!1})},n.onLogin=function(e){"ok"===e.status?(n.saveUsername(n.usernameToSave),P.showCharacterSelect()):(J.modal("Login Error",e.message),n.setState({pending:!1}))},n}return Object(A.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){R.on("connect",this.onConnect),R.on("login",this.onLogin),this.usernameInput.value=this.getSavedUsername()||"",R.isConnected||(this.setState({pending:!0}),R.connect())}},{key:"componentWillUnmount",value:function(){R.removeListener("connect",this.onConnect),R.removeListener("login",this.onLogin)}},{key:"onCreate",value:function(){P.showRegister()}},{key:"onSubmit",value:function(e){e.preventDefault();var t=this.usernameInput.value,n=this.passwordInput.value;this.usernameToSave=t,R.login(t,n)}},{key:"saveUsername",value:function(e){window.localStorage.setItem("username",e)}},{key:"getSavedUsername",value:function(){return window.localStorage.getItem("username")||null}},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement("br",null),s.a.createElement(v,null),s.a.createElement("br",null),s.a.createElement("div",{className:"app-menu"},s.a.createElement(h.a,{onSubmit:this.onSubmit.bind(this)},s.a.createElement(m.a,null,s.a.createElement(d.a,null,"Username"),s.a.createElement(g.a,{innerRef:function(t){return e.usernameInput=t},type:"text",maxLength:20,disabled:this.state.pending,required:!0})),s.a.createElement(m.a,null,s.a.createElement(d.a,null,"Password"),s.a.createElement(g.a,{innerRef:function(t){return e.passwordInput=t},type:"password",maxLength:20,disabled:this.state.pending,required:!0})),s.a.createElement("div",{className:"text-center"},s.a.createElement(E.a,{width:125,disabled:this.state.pending},"Submit"),"\xa0",s.a.createElement(E.a,{type:"button",width:125,disabled:this.state.pending,onClick:this.onCreate.bind(this)},"Create"))),s.a.createElement(U,null)))}}]),t}(s.a.Component),B=function(){function e(){Object(l.a)(this,e)}return Object(c.a)(e,null,[{key:"request",value:function(t){return new Promise(function(n,a){var s=t.url,r=t.method,i=void 0===r?"GET":r,l=t.headers,c=void 0===l?null:l,o=t.query,u=void 0===o?null:o,A=t.data,h=void 0===A?null:A,m=new XMLHttpRequest;if(m.addEventListener("load",function(){return n(m)}),m.addEventListener("error",function(e){return a(e)}),u&&(s+=e.queryString(u)),m.open(i,s,!0),c)for(var d in c)m.setRequestHeader(d,c[d]);m.send(h)})}},{key:"get",value:function(t,n,a,s){return e.request({url:t,headers:n,query:a,data:s,method:"GET"})}},{key:"post",value:function(t,n,a,s){return e.request({url:t,headers:n,query:a,data:s,method:"POST"})}},{key:"queryString",value:function(e){var t=[];for(var n in e)t.push("".concat(n,"=").concat(e[n]));return"?"+t.join("&")}},{key:"getCorsHeaders",value:function(){return{"Access-Control-Allow-Origin":arguments.length>0&&void 0!==arguments[0]?arguments[0]:"*","Access-Control-Allow-Headers":"Access-Control-Allow-Origin"}}}]),e}(),F=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(o.a)(this,Object(u.a)(t).call(this,e))).usernameInput=null,n.passwordInput=null,n.confirmInput=null,n.state={pending:!1},n}return Object(A.a)(t,e),Object(c.a)(t,[{key:"clearForm",value:function(){this.usernameInput.value="",this.passwordInput.value="",this.confirmInput.value=""}},{key:"onCancel",value:function(){P.showLogin()}},{key:"onSubmit",value:function(e){var t=this;e.preventDefault(),this.setState({pending:!0});var n=this.usernameInput.value,a=this.passwordInput.value;if(a!==this.confirmInput.value)return J.modal("Passwords Error","Passwords do not match."),void this.setState({pending:!1});var s="".concat(window.location.origin.replace(":3000",":8080"),"/accounts/create"),r=B.getCorsHeaders(),i=JSON.stringify({username:n,password:a});B.post(s,r,null,i).then(function(e){var n=200===e.status?"Account Created":"Account Error";J.modal(n,e.response),200===e.status&&t.clearForm()}).catch(function(){J.modal("Request Error","HTTP request failed.")}).then(function(){t.setState({pending:!1})})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement("br",null),s.a.createElement(v,null),s.a.createElement("br",null),s.a.createElement("div",{className:"app-menu"},s.a.createElement(h.a,{onSubmit:this.onSubmit.bind(this)},s.a.createElement(m.a,null,s.a.createElement(d.a,null,"Username"),s.a.createElement(g.a,{innerRef:function(t){return e.usernameInput=t},type:"text",maxLength:20,disabled:this.state.pending,required:!0})),s.a.createElement(m.a,null,s.a.createElement(d.a,null,"Password"),s.a.createElement(g.a,{innerRef:function(t){return e.passwordInput=t},type:"password",maxLength:20,disabled:this.state.pending,required:!0})),s.a.createElement(m.a,null,s.a.createElement(d.a,null,"Confirm Password"),s.a.createElement(g.a,{innerRef:function(t){return e.confirmInput=t},type:"password",maxLength:20,disabled:this.state.pending,required:!0})),s.a.createElement("div",{className:"text-center"},s.a.createElement(E.a,{width:125,disabled:this.state.pending},"Submit"),"\xa0",s.a.createElement(E.a,{width:125,type:"button",onClick:this.onCancel.bind(this),disabled:this.state.pending},"Cancel"))),s.a.createElement(U,null)))}}]),t}(s.a.Component),q=n(86),K=n(27),W=n.n(K),H=n(45),V=n(21),Z=n(12),X=n(18),_=n.n(X),$=n(46),ee=n.n($),te=function(e){function t(e,n,a,s,r,i,c){var A;return Object(l.a)(this,t),A=Object(o.a)(this,Object(u.a)(t).call(this,Z.AssetUtils.getImageURLByAlias(e),n,a,0,0,r,i)),s&&A.setNametag(s),c&&A.playAnimation(c),A}return Object(A.a)(t,e),t}(Z.MPGameEntity),ne=function(e){var t=e.type,n=e.name,a=e.anim,s=e.objectID,r=e.team;switch(t){case"blacksmith":return new te("blacksmith",100,100,n,s,r,a);case"paragon":return new te("paragon",100,100,n,s,r,a);case"templar":return new te("templar",100,100,n,s,r,a);case"player":return new te("player",100,100,n,s,r,a);default:return null}};Z.AssetUtils.setImageAliasMany({blacksmith:_.a,paragon:_.a,templar:_.a,player:ee.a});var ae=n(47),se=n.n(ae),re={Grass:function(e){function t(){return Object(l.a)(this,t),Object(o.a)(this,Object(u.a)(t).call(this,Z.AssetUtils.getImageURLByAlias("grass"),ue,ue))}return Object(A.a)(t,e),t}(Z.Sprite)};Z.AssetUtils.setImageAliasMany({grass:se.a});var ie=n(48),le=n.n(ie),ce=function(e){function t(e,n,a,s,r){var i;return Object(l.a)(this,t),(i=Object(o.a)(this,Object(u.a)(t).call(this,Z.AssetUtils.getImageURLByAlias(e),n,a))).nodeID=s,i.setNametag(r),i.moveSpeed=0,i}return Object(A.a)(t,e),t}(Z.GameEntity),oe=function(e){var t=e.type,n=e.nodeID,a=e.text;switch(t){case"airship":return new ce("airship",100,100,n,a,n,a);default:return null}};Z.AssetUtils.setImageAliasMany({airship:le.a});var ue=64;Z.TextField.defaultFont="15px electrolize";var Ae=new(function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(o.a)(this,Object(u.a)(t).call(this))).renderer=new Z.Renderer(1280,720),e.layers=new Z.MapLayers,e.objects=new Z.MPEntityStorage,e.keys=null,e.collisionGrid=null,e.mapBounds=null,e.scroller=null,e.player=null,e.selectedTarget=null,e.renderer.on("render",e.onGameFrame.bind(Object(V.a)(Object(V.a)(e)))),e.renderer.on("click",function(t){return e.layers.processClick(t)}),e.started=!1,e.todo=[],e}return Object(A.a)(t,e),Object(c.a)(t,[{key:"loadAssets",value:function(){return Z.AssetUtils.loadAliases()}},{key:"loadMap",value:function(){var e=Object(H.a)(W.a.mark(function e(t){var n,a,s,r,i,l,c=this;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.unloadMap(),t.name,n=t.mapData,a=t.transportNodes,s=t.units,e.next=4,this.loadAssets();case 4:r=e.sent,(i=r.images.errors+r.sounds.errors)&&J.modal("Assets Error","Error: ".concat(i," assets failed to load. The game will run, but some things might be missing.")),l=this.layers.buildMap({tileSize:ue,background:{tileLayout:n.background,tileTypes:[null,re.Grass]},midground:{tileLayout:n.midground,tileTypes:[null]},foreground:{tileLayout:n.foreground,tileTypes:[null]}}),this.keys=new Z.KeyboardWatcher,this.keys.onKey("+",function(){return c.layers.toggleMapGrid()}),this.collisionGrid=l.collisionGrid,this.mapBounds=l.mapBounds,this.scroller=new Z.Scroller(this.renderer,this.mapBounds),a.forEach(function(e){return c.createTransportNode(e)}),s.forEach(function(e){return c.createObject(e)}),this.renderer.startRendering(this.layers.mapSprite),this.started=!0,this.todo.forEach(function(e){return e()}),this.todo=[];case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"unloadMap",value:function(){this.started=!1,this.renderer.stopRendering(),this.layers.removeAll(),this.objects.clear(),this.keys=null,this.collisionGrid=null,this.mapBounds=null,this.scroller=null,this.player=null}},{key:"createObject",value:function(e){var t=this;if(this.started){var n=e.x,a=e.y,s=e.spawnLocation,r=ne(e);if(r&&this.objects.addObject(r)){if(s){var i=s.col,l=s.row;this.layers.addAt(r,i,l)}else this.layers.add(r),r.setPosition(n,a);r.on("click",function(){return t.selectTarget(r)}),"player"===e.type&&e.ownerID===R.clientID&&(this.player=r,r.on("move",function(){return R.playerUpdate(r.getData())}),R.getObjectStats(r.objectID),R.getAbilityList())}}else this.todo.push(function(){return t.createObject(e)})}},{key:"removeObject",value:function(e){var n=this;if(this.started){var a=this.objects.getObject(e);a&&(a.remove(),this.objects.removeObject(a),t.selectedTarget&&t.selectedTarget.objectID===e&&t.unselectTarget())}else this.todo.push(function(){return n.removeObject(e)})}},{key:"updateObject",value:function(e){var t=this;this.started?this.objects.updateObject(e):this.todo.push(function(){return t.updateObject(e)})}},{key:"createTransportNode",value:function(e){var t=e.spawnLocation,n=t.col,a=t.row,s=oe(e);s&&this.layers.addAt(s,n,a)}},{key:"injectInto",value:function(e){this.renderer.injectInto(e)}},{key:"selectTarget",value:function(e){this.unselectTarget(),this.selectedTarget=e,R.getObjectStats(e.objectID)}},{key:"unselectTarget",value:function(){this.selectedTarget&&(this.selectedTarget=null)}},{key:"castAbility",value:function(e){this.selectedTarget&&R.castAbility(e,this.selectedTarget.objectID)}},{key:"onGameFrame",value:function(){this.player&&this.keys.numKeys>0&&(this.keys.isKeyDown("w")?this.player.moveUp(this.collisionGrid,this.mapBounds,this.scroller):this.keys.isKeyDown("s")&&this.player.moveDown(this.collisionGrid,this.mapBounds,this.scroller),this.keys.isKeyDown("a")?this.player.moveLeft(this.collisionGrid,this.mapBounds,this.scroller):this.keys.isKeyDown("d")&&this.player.moveRight(this.collisionGrid,this.mapBounds,this.scroller),this.layers.depthSort())}}]),t}(p.EventEmitter)),he=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(o.a)(this,Object(u.a)(t).call(this,e))).state={pending:!1,characterList:null,errMessage:null},n.onCharacterList=function(e){"ok"===e.status?n.setState({characterList:e.characterList||null}):(J.modal("Characters Error",e.message),n.setState({errMessage:e.message}))},n.onEnterMap=function(e){"ok"===e.status?(P.showGame(),Ae.loadMap(e.mapState)):(J.modal("Characters Error",e.message),n.setState({pending:!1}))},n}return Object(A.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){R.on("character-list",this.onCharacterList),R.on("enter-map",this.onEnterMap),R.on("enter-instance",this.onEnterMap),R.getCharacterList()}},{key:"componentWillUnmount",value:function(){R.removeListener("character-list",this.onCharacterList),R.removeListener("enter-map",this.onEnterMap),R.removeListener("enter-instance",this.onEnterMap)}},{key:"onCreate",value:function(){P.showCharacterCreate()}},{key:"onLogout",value:function(){R.logout(),P.showLogin()}},{key:"selectPlayer",value:function(e){this.setState({pending:!0}),R.selectCharacter(e)}},{key:"renderCharacterList",value:function(){var e=this,t=this.state.characterList;if(!t)return s.a.createElement("div",null,this.state.characterListErrMsg||"Loading...");for(var n=[],a=0;a<6;a++){var r=t[a]||null;r?function(){var t=r.name,i=r.level,l=r.last_map;n.push(s.a.createElement("tr",{key:a},s.a.createElement("td",null,t),s.a.createElement("td",null,"Level ",i),s.a.createElement("td",null,l),s.a.createElement("td",null,s.a.createElement(E.a,{width:125,onClick:function(){return e.selectPlayer(t)},disabled:e.state.pending},"Select"))))}():n.push(s.a.createElement("tr",{key:a},s.a.createElement("td",null,s.a.createElement(E.a,{width:125,onClick:this.onCreate.bind(this),disabled:this.state.pending},"Create"))))}return s.a.createElement("div",null,s.a.createElement(q.a,null,s.a.createElement("thead",null,n)),this.renderLogoutBtn())}},{key:"renderLogoutBtn",value:function(){return s.a.createElement("div",{className:"text-center"},s.a.createElement(E.a,{width:125,disabled:this.state.pending,onClick:this.onLogout.bind(this)},"Logout"))}},{key:"renderBody",value:function(){var e=this.state,t=e.characterList,n=void 0===t?null:t,a=e.errMessage,r=void 0===a?null:a;return r?s.a.createElement("div",null,s.a.createElement("div",null,r),this.renderLogoutBtn()):n?this.renderCharacterList():s.a.createElement("div",null,"Loading...")}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement("div",{className:"app-menu"},s.a.createElement("br",null),this.renderBody()))}}]),t}(s.a.Component),me=n(87),de=n(88),ge=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(o.a)(this,Object(u.a)(t).call(this,e))).nameInput=null,n.skinInput=null,n.state={pending:!1},n.onCharacterCreate=function(e){"ok"===e.status?P.showMenu("character-select"):(J.modal("Character Error",e.message),n.setState({pending:!1}))},n}return Object(A.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){R.on("character-create",this.onCharacterCreate)}},{key:"componentWillUnmount",value:function(){R.removeListener("character-create",this.onCharacterCreate)}},{key:"onCancel",value:function(){P.showMenu("character-select")}},{key:"onSubmit",value:function(e){e.preventDefault(),this.setState({pending:!0});var t=this.nameInput.value,n=this.skinInput.value;R.createCharacter(t,n)}},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement("br",null),s.a.createElement("div",{className:"app-menu"},s.a.createElement(h.a,{onSubmit:this.onSubmit.bind(this)},s.a.createElement(m.a,null,s.a.createElement(d.a,null,"Name"),s.a.createElement(g.a,{innerRef:function(t){return e.nameInput=t},type:"text",maxLength:15,disabled:this.state.pending,required:!0})),s.a.createElement(m.a,null,s.a.createElement(d.a,null,"Skin"),s.a.createElement(me.a,null,s.a.createElement(de.a,{lg:6},s.a.createElement(g.a,{innerRef:function(t){return e.skinInput=t},type:"select",disabled:this.state.pending,required:!0},s.a.createElement("option",{value:1},"Human Male"),s.a.createElement("option",{value:2},"Human Female"))),s.a.createElement(de.a,{lg:6},"(Preview)"))),s.a.createElement("div",{className:"text-center"},s.a.createElement(E.a,null,"Submit"),"\xa0",s.a.createElement(E.a,{type:"button",width:125,onClick:this.onCancel.bind(this)},"Cancel")))))}}]),t}(s.a.Component),Ee=(n(70),function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(o.a)(this,Object(u.a)(t).call(this,e))).displayRef=s.a.createRef(),n.inputRef=s.a.createRef(),n.onChatReceived=function(e){if("ok"===e.status){var t=n.displayRef.current,a=e.from?"".concat(e.from,": ").concat(e.chat):e.chat;t.value?t.value+="\n"+a:t.value=a}},n}return Object(A.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){R.on("chat",this.onChatReceived)}},{key:"componentWillUnmount",value:function(){R.removeListener("chat",this.onChatReceived)}},{key:"onChatSend",value:function(e){if(13===e.keyCode){var t=this.inputRef.current.value;t&&(R.chatMessage(t),this.inputRef.current.value="")}}},{key:"render",value:function(){return s.a.createElement("div",{className:"hud-chat"},s.a.createElement("textarea",{ref:this.displayRef,readOnly:!0}),s.a.createElement("br",null),s.a.createElement("input",{ref:this.inputRef,type:"text",maxLength:128,onKeyUp:this.onChatSend.bind(this)}))}}]),t}(s.a.Component)),ve=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(o.a)(this,Object(u.a)(t).call(this,e))).state={stats:null},n.onObjectStats=function(e){if("ok"===e.status&&Ae.selectedTarget){var t=e.stats;Ae.selectedTarget.objectID===t.objectID&&n.setState({stats:t})}},n}return Object(A.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){R.on("object-stats",this.onObjectStats)}},{key:"componentWillUnmount",value:function(){R.removeListener("object-stats",this.onObjectStats)}},{key:"renderStats",value:function(){var e=this.state.stats;if(!e)return null;var t=e.base,n=e.current,a=e.name,r=e.team,i=e.level,l=void 0===i?null:i;return s.a.createElement("table",null,s.a.createElement("tbody",null,s.a.createElement("tr",{className:"text-center"},s.a.createElement("td",{colSpan:2},a," ",l?"(".concat(l,")"):null)),s.a.createElement("tr",{className:"text-center"},s.a.createElement("td",{colSpan:2},"<",r,">")),s.a.createElement("tr",null,s.a.createElement("td",null,"HP"),s.a.createElement("td",null,n.health.toFixed(0)," / ",t.health.toFixed(0))),s.a.createElement("tr",null,s.a.createElement("td",null,"MP"),s.a.createElement("td",null,n.mana.toFixed(0)," / ",t.mana.toFixed(0))),s.a.createElement("tr",null,s.a.createElement("td",null,"DEF"),s.a.createElement("td",null,(100*t.defense).toFixed(0),"%")),s.a.createElement("tr",null,s.a.createElement("td",null,"RES"),s.a.createElement("td",null,(100*t.resistance).toFixed(0),"%"))))}},{key:"render",value:function(){return this.state.stats?s.a.createElement("div",{className:"hud-target"},this.renderStats()):null}}]),t}(s.a.Component),pe=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(o.a)(this,Object(u.a)(t).call(this,e))).state={stats:null},n.onObjectStats=function(e){if("ok"===e.status&&Ae.player){var t=e.stats;Ae.player.objectID===t.objectID&&n.setState({stats:t})}},n}return Object(A.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){R.on("object-stats",this.onObjectStats)}},{key:"componentWillUnmount",value:function(){R.removeListener("object-stats",this.onObjectStats)}},{key:"renderStats",value:function(){var e=this.state.stats;if(!e)return null;var t=e.base,n=e.current,a=e.level,r=e.xp,i=e.xpNeeded,l=e.name;return s.a.createElement("table",null,s.a.createElement("tbody",null,s.a.createElement("tr",{className:"text-center"},s.a.createElement("td",{colSpan:2},l," - Level ",a)),s.a.createElement("tr",null,s.a.createElement("td",null,"HP"),s.a.createElement("td",null,n.health.toFixed(0)," / ",t.health.toFixed(0))),s.a.createElement("tr",null,s.a.createElement("td",null,"MP"),s.a.createElement("td",null,n.mana.toFixed(0)," / ",t.mana.toFixed(0))),s.a.createElement("tr",null,s.a.createElement("td",null,"XP"),s.a.createElement("td",null,r.toFixed(0)," / ",i.toFixed(0)))))}},{key:"render",value:function(){return this.state.stats?s.a.createElement("div",{className:"hud-player"},this.renderStats()):null}}]),t}(s.a.Component),be=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(o.a)(this,Object(u.a)(t).call(this,e))).state={abilityList:null},n.onAbilityList=function(e){"ok"===e.status&&(console.log(e),n.setState({abilityList:e.abilityList}))},n}return Object(A.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){R.on("ability-list",this.onAbilityList)}},{key:"componentWillUnmount",value:function(){R.removeListener("ability-list",this.onAbilityList)}},{key:"renderAbilityList",value:function(){for(var e=this.state.abilityList||[],t=new Array(10),n=function(n){var a=e[n]||null,r=null;r=a?s.a.createElement("img",{key:n,src:null,width:64,height:64,disabled:!1,title:a.abilityName,onClick:function(){return Ae.castAbility(a.abilityName)}}):s.a.createElement("img",{key:n,src:null,width:64,height:64,disabled:!0}),t[n]=r},a=0;a<t.length;a++)n(a);return s.a.createElement("div",null,t.slice(0,5),s.a.createElement("br",null),t.slice(5,10))}},{key:"render",value:function(){return s.a.createElement("div",{className:"hud-abilities"},this.renderAbilityList())}}]),t}(s.a.Component),fe=n(89),ye=n(90),je=n(91),ze=n(92),ke=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(o.a)(this,Object(u.a)(t).call(this,e))).state={isOpen:!1},n.onMapPlayers=function(e){"ok"===e.status&&J.modal("Nearby Players",Object.keys(e.players).map(function(t){return"".concat(t," (Level ").concat(e.players[t],")")}).join(", "))},n}return Object(A.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){R.on("map-players",this.onMapPlayers)}},{key:"componentWillUnmount",value:function(){R.removeListener("map-players",this.onMapPlayers)}},{key:"toggle",value:function(){this.setState({isOpen:!this.state.isOpen})}},{key:"onFindPlayers",value:function(){R.getMapPlayers()}},{key:"onExit",value:function(){Ae.unloadMap(),P.showLogin(),R.logout()}},{key:"renderAdminItems",value:function(){return R.accessLevel>1?[s.a.createElement(fe.a,{key:0,divider:!0}),s.a.createElement(fe.a,{key:1,header:!0},"Admin Commands"),s.a.createElement(fe.a,{key:2},"Upgrades Menu"),s.a.createElement(fe.a,{key:3},"Instances Menu")]:null}},{key:"render",value:function(){return s.a.createElement("div",{className:"hud-dropdown"},s.a.createElement(ye.a,{isOpen:this.state.isOpen,toggle:this.toggle.bind(this)},s.a.createElement(je.a,{caret:!0},"Menu"),s.a.createElement(ze.a,null,s.a.createElement(fe.a,{header:!0},"Current Map"),s.a.createElement(fe.a,{onClick:this.onFindPlayers.bind(this)},"Find Players"),s.a.createElement(fe.a,{divider:!0}),s.a.createElement(fe.a,{header:!0},"Quit"),s.a.createElement(fe.a,{onClick:this.onExit.bind(this)},"Exit/Logout"),this.renderAdminItems())))}}]),t}(s.a.Component),Ce=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(o.a)(this,Object(u.a)(t).call(this,e))).containerRef=s.a.createRef(),n.onObjectCreate=function(e){return Ae.createObject(e.spawnState)},n.onObjectDelete=function(e){return Ae.removeObject(e.objectID)},n.onObjectUpdate=function(e){return Ae.updateObject(e.updateState)},n}return Object(A.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){R.on("object-create",this.onObjectCreate),R.on("object-delete",this.onObjectDelete),R.on("object-update",this.onObjectUpdate),Ae.injectInto(this.containerRef.current)}},{key:"componentWillUnmount",value:function(){R.removeListener("object-create",this.onObjectCreate),R.removeListener("object-delete",this.onObjectDelete),R.removeListener("object-update",this.onObjectUpdate)}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement("div",{ref:this.containerRef,className:"canvas-container"}),s.a.createElement(Ee,null),s.a.createElement(ve,null),s.a.createElement(pe,null),s.a.createElement(be,null),s.a.createElement(ke,null))}}]),t}(s.a.Component),Ie=n(96),Oe=n(93),xe=n(94),Ne=n(95),Qe=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(o.a)(this,Object(u.a)(t).call(this,e))).state={isOpen:!1,header:null,body:null,footer:null},n.onModal=function(e){n.setState({isOpen:!0,header:e.header||null,body:e.body||null,footer:e.footer||null})},n}return Object(A.a)(t,e),Object(c.a)(t,[{key:"componentWillMount",value:function(){J.on("modal",this.onModal)}},{key:"componentWillUnmount",value:function(){J.removeListener("modal",this.onModal)}},{key:"toggle",value:function(){this.setState({isOpen:!this.state.isOpen})}},{key:"render",value:function(){return s.a.createElement(Ie.a,{isOpen:this.state.isOpen,toggle:this.toggle.bind(this)},s.a.createElement(Oe.a,{toggle:this.toggle.bind(this)},this.state.header||null),s.a.createElement(xe.a,null,this.state.body||null),s.a.createElement(Ne.a,null,this.state.footer||null))}}]),t}(s.a.Component),we=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(o.a)(this,Object(u.a)(t).call(this,e))).state={menu:"login"},n.onMenu=function(e){return n.setState({menu:e.menu})},n.onClientClose=function(){J.modal("Socket Error","Connection error."),P.showLogin()},n.onClientError=function(e){},n}return Object(A.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){P.on("menu",this.onMenu),R.on("close",this.onClientClose),R.on("error",this.onClientError)}},{key:"componentWillUnmount",value:function(){P.removeListener("menu",this.onMenu),R.removeListener("close",this.onClientClose),R.removeListener("error",this.onClientError)}},{key:"renderMenu",value:function(){switch(this.state.menu){case"login":return s.a.createElement(T,null);case"register":return s.a.createElement(F,null);case"character-select":return s.a.createElement(he,null);case"character-create":return s.a.createElement(ge,null);case"game":return s.a.createElement(Ce,null);default:return null}}},{key:"render",value:function(){return s.a.createElement("div",null,this.renderMenu(),s.a.createElement(Qe,null))}}]),t}(s.a.Component);n(79);i.a.render(s.a.createElement(we,null),document.querySelector("#root"))}},[[49,2,1]]]);
//# sourceMappingURL=main.3b9e0bec.chunk.js.map